<% @title_tag = "Ask an Expert Question - #{truncate_at_word(@submitted_question.asked_question, 80)}"%>

<div id="public_aae">
    <h1>Your Question</h1>
    
    <div id="primary">
    
        <div id="question_area">
        <%= render (:partial => "ask/question") %>
        </div>
     
        <% if (@submitted_question.public_user.id == session[:public_user_id]) or (@currentuser.email == @submitted_question.submitter_email) %>
    
            <% if !((response = @submitted_question.current_response) and (response.strip != '')) %>
            <p class="inc_descriptive editpitch">
            <%= link_to_remote 'Edit my question', 
                          :update => "question_area",
                          :url => { :action => "make_question_editable", :squid => @submitted_question.id }  %>.
                          Need to clarify or correct any information? Your question is editable until one of our experts responds. Thanks!
            </p>
            <% end %>
    
        <% end %>
        <p class="inc_descriptive">This question was submitted <%= time_ago_in_words(@submitted_question.created_at) %> ago.</p>
    

        <% if (response = @submitted_question.current_response) and (response.strip != '') %>
    
        <% else %>
            <div id="no_answer">
                <h2>We don’t have an answer for you yet...</h2>
                <p>As soon as we have one, we’ll send you an email.</p>
            
                <% if (@submitted_question.public_user.id == session[:public_user_id]) or (@currentuser.email == @submitted_question.submitter_email) %>
                <h3>Need to clarify or correct any information?</h3>
                <p>Your question is editable until one of our experts responds. Click the "Edit my question" link above.</p>
                <% end %>
            </div>
        <% end %>
    
        <div id="responses">
            <% if @submitted_question_responses.length > 0 %>
                <h3>Responses:</h3>
                <% @submitted_question_responses.each do |response| %>
      
                    <div class="commentblock <%= is_public_responder(response) ? "public": "expert" %>" >
                        <p class="comment">
                            <img src="/images/common/extension_icon.jpg" />
                            <%= format_aae_response(response.response) %>
                            <%= prepare_signature(response) %>
                        </p>
                        <p class="meta">Posted <%= time_ago_in_words(response.created_at) %> ago</p>
                    </div>
                <% end %>
            <% end %>
        </div>
    <p id="loading_response" class="float-spinner" style="display:none"><img src='/images/loading.gif' /> Saving... </p>
    
        <% if @submitted_question_responses.length > 0 and ((@submitted_question.public_user.id == session[:public_user_id]) or (@currentuser.email == @submitted_question.submitter_email)) %>
            <h3><%= link_to_function 'Add a comment', "Effect.toggle('additional_comment','blind', { duration: .4});" %> or <%= link_to 'Ask a new question', ask_form_url %></h3>
            <div id="additional_comment" style="display:none;">
                <% form_remote_tag :update => 'responses', :url => {:controller => :ask, :action => :post_public_response, :squid => @submitted_question.id, :public_user_id => @submitted_question.public_user_id}, :loading => "Element.show('loading_response')", :complete => "['loading_response', 'additional_comment'].each(Element.hide);$('public_user_response').value = ''"  do %>
                <%= text_area_tag("public_user_response", nil, :cols => "20", :rows => "3") %>
                <%= submit_tag "Post response" %>
                <% end %>
            </div>
            <p class="aae_pitch">Have another question? <%= link_to 'Ask one of our Experts', ask_form_url %></p>
        <% end %>
    
    </div>


    <div id="privacy_options">
        <h4>Who can see this page?</h4>
        <p>This page is private.</p>

        <p>To view this page you have to know its web address (which is not public) and the email address used to submit the question.</p>
    </div>
    
    <%- if(!@currentuser.nil?) -%>
        <div id="aae_link">
            <p><%= link_to("Ask an Expert link", "/aae/question/#{@submitted_question.id}") %> (this link is only visible to authenticated eXID users.)</p>
        </div>
    <%- end -%>
    

</div>