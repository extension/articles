<p id="aae_images">
  <% @submitted_question.file_attachments.each do |sq_img| %>
    <p>    
    <a class="fancybox" href="<%= sq_img.attachment.url %>" title="AaE Image">
    <%= image_tag sq_img.attachment.url(:thumb) %>
    </a><br />
    <%= button_to_remote 'Delete Image', :url => { :action => :delete_image, :id => sq_img.id, :squid => @submitted_question.id  },
        :loading => "Element.show('loading')",
        :complete    => "Element.hide('loading')"  %>
    <div id="loading" style="display:none"><p><img src='/images/widgets/ajax_loader_white.gif' /> Loading... </p></div>
    </p>
    <br /><br />
  <% end %>
  
  <% if (@submitted_question.public_user.id == session[:public_user_id]) or (@currentuser.email == @submitted_question.submitter_email) and ((number_of_attachments = @submitted_question.file_attachments.length) < FileAttachment::MAX_AAE_UPLOADS) %>
  <p class="inc_descriptive editpitch">
  <%= link_to_function "Add Images", "Effect.toggle('add_uploads','blind', { duration: .4}); if(this.innerHTML == 'Add Images') {this.innerHTML = 'Cancel';} else {this.innerHTML = 'Add Images'}" %>
  </p>
  <div id="add_uploads" style="display:none;">
  <h3>Additional Images</h3>
  <% images_possible = FileAttachment::MAX_AAE_UPLOADS - number_of_attachments %>
  <p>You can include up to <%= images_possible %> additional image<%= images_possible > 1 ? 's' : '' %>:</p>
  <i><b>Must be either .jpg OR .png OR .gif with max size of 2MB each</b></i>
    
  <fieldset>
  <% form_for :file_attachment, :url => { :action => :add_images }, :html => {:class => 'aae', :multipart => true } do |f| %>
  <%= hidden_field_tag :squid, @submitted_question.id %>
  <% (1..(images_possible)).each do |image_counter| %>
    <% fields_for "file_attachment#{image_counter}" do |file_attachment| %> 
    <p class="image_upload"><%= file_attachment.file_field :attachment %></p>
    <% end %>
  <% end %>
  <p><%= submit_tag "Submit", :alt => "Go", :class => "bigbutton blue" %></p>
  <% end %>
  </fieldset>
  
  </div>
  <% end %>
</p>